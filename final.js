(()=>{var e={172:e=>{"use strict";e.exports=require("archiver")},268:e=>{"use strict";e.exports=require("body-parser")},686:e=>{"use strict";e.exports=require("convert-excel-to-json")},577:e=>{"use strict";e.exports=require("cors")},252:e=>{"use strict";e.exports=require("express")},461:e=>{"use strict";e.exports=require("multer")},379:e=>{"use strict";e.exports=require("node-mailjet")},896:e=>{"use strict";e.exports=require("fs")}},o={};function s(a){var r=o[a];if(void 0!==r)return r.exports;var t=o[a]={exports:{}};return e[a](t,t.exports,s),t.exports}(()=>{const e=s(252),o=s(461),a=s(379),r=s(686),t=s(268);var i=s(577);const l=e(),n=process.env.PORT||3e3;var d=s(896);const c=s(172);l.use(t.json({limit:"50mb"})),l.use(t.urlencoded({limit:"50mb",extended:!0}));const u="uploads/moneglisedata",m=[{Email:"fpmamelun@gmail.com",Name:"FPMA MELUN"},{Email:"77fpmamelun@gmail.com",Name:"User site"}];var p=o.diskStorage({destination:"./uploadsTmp/",limits:{fileSize:5e6},fileFilter:(e,o,s)=>{if(!o.originalname.match(/\.(png|jpeg|jpg|xlsx)$/))return s(new Error("Please upload a Picture(PNG or JPEG)"));s(void 0,!0)},filename:function(e,o,s){s(null,o.originalname)}});l.use(i({origin:"*",methods:["GET","POST","PUT","DELETE"]}));var f=o({storage:p});const y=function(e,o){d.stat(o,(function(s,a){s?d.copyFile(e,o,(o=>{o?console.log("Error Found: copyFile",o):d.rmSync(e,{force:!0})})):d.unlink(o,(function(s){if(s)return console.log(s);d.copyFile(e,o,(o=>{o?console.log("Error Found: copyFile",o):d.rmSync(e,{force:!0})}))}))}))};function g(e,o,s){return s.indexOf(e)===o}l.post("/api/checkPwd",((e,o)=>{try{const s=r({sourceFile:u+".xlsx",header:{rows:1},columnToKey:{"*":"{{columnHeader}}"}});user={id:e.body.id,pwd:e.body.pwd},isOk=!1,isRole="user",pwd_=(new Date).getFullYear().toString()+("0"+((new Date).getMonth()+1).toString()).slice(-2)+("0"+(new Date).getDate().toString()).slice(-2),s.login.forEach((e=>{e.id==user.id&&e.mdp==Buffer.from(user.pwd).toString("base64")&&(isOk=!0,isRole=e.role)})),isOk?o.status(200).json({res:Buffer.from("OK."+Date.now().toString()).toString("base64"),role:isRole}):o.status(200).json({res:Buffer.from("KO."+Date.now().toString()).toString("base64")})}catch(e){o.status(500)}})),l.post("/api/uploadxlsx",f.single("file"),((e,o)=>{var s=__dirname+"/uploadsTmp/"+e.file.filename,a=__dirname+"/"+u+".xlsx";try{y(s,a),o.status(200).json([])}catch(e){console.error(e)}})),l.post("/api/uploadimg",f.single("file"),((e,o)=>{var s=__dirname+"/uploadsTmp/"+e.file.filename,a=__dirname+"/uploads/"+e.body.folder+"/"+e.file.filename;if(null==e.file?.filename||"undefined"==e.file?.filename)o.status(400).json("No File uploadimg");else try{var r;d.existsSync(__dirname+"/uploads/"+e.body.folder)?(y(s,a),(r=d.readdirSync(__dirname+"/uploads/"+e.body.folder)).push("/uploads/"+e.body.folder+"/"+e.file.filename),o.status(200).json(r)):(d.mkdirSync(__dirname+"/uploads/"+e.body.folder),y(s,a),r=(r=d.readdirSync(__dirname+"/uploads/"+e.body.folder)).map((o=>"/uploads/"+e.body.folder+"/"+o)),r.push("/uploads/"+e.body.folder+"/"+e.file.filename),o.status(200).json(r))}catch(e){console.error(e)}})),l.post("/api/dataxlsx",f.single("file"),((e,o)=>{try{null!=e.file?.filename&&"undefined"!=e.file?.filename||o.status(400).json("No File"),o.status(200).json({})}catch(e){console.error(e)}})),l.post("/api/uploadNews",f.single("file"),((e,o)=>{var s="ARTICLES",a=__dirname+"/uploadsTmp/"+e.file.filename,r=__dirname+"/uploads/"+s+"/"+e.body.id+"_"+e.file.filename;if(null==e.file?.filename||"undefined"==e.file?.filename)o.status(400).json("No File");else{let t=__dirname+"/uploadsTmp/"+e.body.id+"_"+e.file.filename;d.rename(a,t,(a=>{a&&console.error("error rename =>"+a);try{if(d.existsSync(__dirname+"/uploads/"+s)){y(t,r);let a=d.readdirSync(__dirname+"/uploads/"+s);a=a.map((e=>"/uploads/"+s+"/"+e)),a.push("/uploads/"+s+"/"+ +e.body.id+"_"+e.file.filename),o.status(200).json(a)}else{d.mkdirSync(__dirname+"/uploads/"+s),y(t,r);let a=d.readdirSync(__dirname+"/uploads/"+s);a=a.map((e=>"/uploads/"+s+"/"+e)),a.push("/uploads/"+s+"/"+ +e.body.id+"_"+e.file.filename),o.status(200).json(a)}}catch(a){console.error(a)}}))}})),l.get("/api/readAlls",((e,o)=>{try{const e=r({sourceFile:u+".xlsx",header:{rows:1},columnToKey:{"*":"{{columnHeader}}"}});o.status(200).json(e)}catch(e){o.status(500)}})),l.get("/api/readArticles",((e,o)=>{try{const e=r({sourceFile:u+".xlsx",header:{rows:1},columnToKey:{"*":"{{columnHeader}}"}}),s="./uploads/ARTICLES/";d.existsSync(s)?(imgByFolder=d.readdirSync(s),e.articles.forEach((e=>{e.id&&(e.img=imgByFolder.filter((o=>o.split("_")[0]==e.id))[0]?s.replace("./","")+imgByFolder.filter((o=>o.split("_")[0]==e.id))[0]:"")}))):o.send("pas d images dans rep=>"+folder),o.status(200).json(e.articles)}catch(e){o.status(500)}})),l.get("/api/readPhotosSampana",((e,o)=>{try{const e="SAMPANA";d.existsSync(__dirname+"/uploads/"+e)||d.mkdirSync(__dirname+"/uploads/"+e),imgByFolder=d.readdirSync(__dirname+"/uploads/"+e),imgByFolder=imgByFolder.map((o=>"/uploads/"+e+"/"+o)),o.status(200).json(imgByFolder)}catch(e){o.status(500)}})),l.get("/api/readPhotosEvenements",((e,o)=>{try{const e="EVENEMENTS";d.existsSync(__dirname+"/uploads/"+e)||d.mkdirSync(__dirname+"/uploads/"+e),imgByFolder=d.readdirSync(__dirname+"/uploads/"+e),imgByFolder=imgByFolder.map((o=>"/uploads/"+e+"/"+o)),o.status(200).json(imgByFolder)}catch(e){o.status(500)}})),l.get("/api/readPhotosBirao",((e,o)=>{try{const e="BIRAO";d.existsSync(__dirname+"/uploads/"+e)||d.mkdirSync(__dirname+"/uploads/"+e),imgByFolder=d.readdirSync(__dirname+"/uploads/"+e),imgByFolder=imgByFolder.map((o=>"/uploads/"+e+"/"+o)),o.status(200).json(imgByFolder)}catch(e){o.status(500)}})),l.get("/api/readPhotos",((e,o)=>{try{const e=r({sourceFile:u+".xlsx",header:{rows:1},columnToKey:{"*":"{{columnHeader}}"}});var s=e.photos.map((e=>({cat:e.category,type:e.type,order:e.order}))).filter((e=>"photo"==e.type)).map((e=>e.cat)).filter(g);s.forEach((o=>{var s="./uploads/"+o;e.photos.forEach((e=>{if(d.existsSync(s)){if("photo"==e.type&&o==e.category){var a=d.readdirSync(s).map((e=>s.replace("./","")+"/"+e));e.img=a}}else"photo"==e.type&&o==e.category&&(e.img=[])}))})),o.status(200).json(e.photos)}catch(e){o.status(500)}})),l.get("/api/readEvenements",((e,o)=>{try{const e=r({sourceFile:u+".xlsx",header:{rows:1},columnToKey:{"*":"{{columnHeader}}"}});o.status(200).json(e.evenements)}catch(e){o.status(500)}})),l.get("/api/readProfil",((e,o)=>{try{const e=r({sourceFile:u+".xlsx",header:{rows:1},columnToKey:{"*":"{{columnHeader}}"}});e.profil.forEach((e=>{e.coupleNomImg={nom:e.nom,img:e.img,profil:e.profil}})),o.status(200).json(e.profil)}catch(e){o.status(500)}})),l.get("/api/readInfos",((e,o)=>{try{const e=r({sourceFile:u+".xlsx",header:{rows:1},columnToKey:{"*":"{{columnHeader}}"}});o.status(200).json(e.infos)}catch(e){o.status(500)}})),l.post("/api/readPhotoUploaded",((e,o)=>{try{var s=e.query.folder?e.query.folder:"",a=[];const r="./uploads/"+s;d.existsSync(r)?a=d.readdirSync(r):o.send("pas d images dans rep=>"+s),o.status(200).json(a)}catch(e){console.log(e),o.status(500)}})),l.post("/api/deletePhotoUploaded",((e,o)=>{try{var s=e.body.file?e.body.file:"",a=e.body.folder?e.body.folder:"",r=[];const t="./uploads/"+a;d.existsSync(s)?d.unlink(s,(e=>{e&&console.log(e),console.log("deleted=>"+s),r=d.readdirSync(t),o.status(200).json(r)})):o.status(500)}catch(e){console.log(e),o.status(500)}})),l.post("/api/contact",((e,o)=>{const{nom:s,message:r,email:t,sujet:i}=e.body;var l={name_:s,message_:r,email_:t,sujet_:i};let n="<!DOCTYPE html><html><body><table width='100%'  ><tr><td> <p>(message)</p> </td> </tr></table><br/>(nom)<br/>(email)</body></html>";a.apiConnect("119b03cc5715502c6056b128a3ca164d","81dd033a4bbe046a9353a898cc988e68",{config:{},options:{}}).post("send",{version:"v3.1"}).request({Messages:[{From:{Email:"77fpmamelun@gmail.com",Name:"Via Site"},To:m,Subject:l.sujet_,TextPart:n.replace("(email)",l.email_).replace("(nom)",l.name_).replace("(message)",l.message_),HTMLPart:n.replace("(email)",l.email_).replace("(nom)",l.name_).replace("(message)",l.message_)}]}).then((e=>{o.status(200).json(l)})).catch((e=>{console.log(e.statusCode),o.status(500)}))})),l.get("/api/zip",(function(e,o){try{var s=d.createWriteStream("target.zip"),a=c("zip");s.on("close",(function(){console.log(a.pointer()+" total bytes")})),a.on("error",(function(e){throw e})),a.pipe(s),a.directory("uploads",!1),a.finalize();let e=d.readdirSync("./");o.status(200).json(e)}catch(e){console.log(e),o.status(500)}})),l.use(e.static(__dirname+"/")),l.get("*",((e,o)=>{o.sendFile(__dirname+"/index.html")})),l.listen(n,(()=>{console.log(`Example app listening on port ${n}`)}))})()})();